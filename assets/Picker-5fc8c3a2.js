import{c as C,j as m}from"./locales-548059eb.js";import{r as o}from"./react-libs-840bfe49.js";import{u as ee,a as te,b as ne}from"./use-gesture-react.esm-484f41f1.js";import{i as se,c as q,e as re}from"./base-1da74170.js";import{b as oe}from"./bound-41eb6e06.js";import{C as Z}from"./ConfigProviderContext-0f984393.js";import{u as ie}from"./use-set-state-898f20ed.js";import{u as ce}from"./use-update-effect-09c1ca0c.js";import{r as Q}from"./number-b57f7cd4.js";import{L as ae}from"./Loading-c60598b2.js";import{u as le}from"./use-refs-92151253.js";import{e as ue}from"./constant-7552c2aa.js";import{u as fe}from"./use-event-listener-721bbec6.js";import{p as me}from"./event-07a78c2b.js";import{u as de}from"./unit-bb3e6514.js";const{hasOwnProperty:he}=Object.prototype;function ge(e,r,c){const N=r[c];se(N)&&(!he.call(e,c)||!q(N)?e[c]=N:e[c]=p(Object(e[c]),r[c]))}function p(e,r){return Object.keys(r).forEach(c=>{ge(e,r,c)}),e}function A(e){return Array.isArray(e)?e.map(r=>A(r)):typeof e=="object"?p({},e):e}function W(e,r,c){return e*r*c/(r+c*e)}function Ce(e,r,c,N,u=.15){return u===0?oe(e,r,c):e<r?-W(r-e,N,u)+r:e>c?+W(e-c,N,u)+c:e}function X(e){return q(e)&&e.disabled}const Y=200,xe=15,be=o.forwardRef((e,r)=>{const{prefixCls:c,createNamespace:N}=o.useContext(Z),[u]=N("picker-column",c),{itemHeight:x,visibleItemCount:K,defaultIndex:w,initialOptions:O}=e,[,_]=o.useState({}),P=o.useRef(null),h=o.useRef(null),b=o.useRef(w),f=o.useRef(A(O)),[g,D]=ie({offset:0,duration:0,options:A(O)}),E=o.useMemo(()=>f.current.length,[f.current.length]),y=o.useMemo(()=>x*(+K-1)/2,[x,K]),k=o.useRef(!1),[{y:M},I]=ee(()=>({from:{y:w*-x+y},config:{tension:400,mass:.8}})),S=s=>{s=Q(s,0,E);for(let a=s;a<E;a+=1)if(!X(f.current[a]))return a;return null},v=(s,a)=>{s=S(s)||0;const l=s*-x;I.start({y:l+y}),s!==b.current&&(b.current=s,a&&e.onChange&&setTimeout(()=>{e.onChange(s)},0)),D({offset:l})},j=s=>{JSON.stringify(s)!==JSON.stringify(f.current)&&(f.current=s,_({}))},H=s=>{k.current||e.readonly||(D({duration:Y}),v(s,!0))};function $(s){return q(s)&&e.textKey in s}const T=s=>$(s)?s[e.textKey]:s,L=s=>Q(Math.round(-s/e.itemHeight),0,E-1),U=te(s=>{if(!e.readonly)if(k.current=!0,s.tap)D({duration:0,offset:s.offset[1]});else if(s.last){const a=Math.abs(s.velocity[1]*s.direction[1]*50)>xe,l=s.offset[1]+s.velocity[1]*s.direction[1]*50-y,R=L(l);D({duration:a?+e.swipeDuration:Y,offset:l+y}),v(R,!0)}else{const a=s.offset[1],l=y,R=-(E*x)+y,V=Ce(a,R,l,x*50,.2);I.start({y:V})}},{axis:"y",from:()=>[0,M.get()],filterTaps:!0,pointer:{touch:!0}}),F=o.useMemo(()=>{const s={height:`${e.itemHeight}px`};return f.current.map((a,l)=>{const R=T(a),V=X(a),z={role:"button",key:l,style:s,tabIndex:V?-1:0,className:C(u("item",{disabled:V,selected:l===b.current})),onClick:()=>{k.current=!1,H(l)}},t={className:"rc-ellipsis",children:R};return m.jsx("li",{...z,children:e.optionRender?e.optionRender(a):m.jsx("div",{...t})})})},[f.current,b.current,H,e.optionRender]),B=s=>{const a=f.current;for(let l=0;l<a.length;l+=1)if(T(a[l])===s)return v(l);return null},J=o.useCallback(()=>f.current[b.current],[b.current,f.current]);return o.useEffect(()=>{v(w)},[w]),ce(()=>{j(A(O))},[O]),o.useImperativeHandle(r,()=>({state:g,getIndex:()=>b.current,getOptions:()=>f.current,setIndex:v,getValue:J,setValue:B,setOptions:j})),m.jsx("div",{ref:P,className:C(u(),e.className),...U(),children:m.jsx(ne.ul,{ref:h,className:C(u("wrapper")),style:{y:M,transitionDuration:`${g.duration}ms`,transitionProperty:g.duration?"all":"none"},"aria-hidden":!0,children:F})})}),ye=o.memo(be,(e,r)=>!(e.index!==r.index||e.textKey!==r.textKey||JSON.stringify(e.initialOptions)!==JSON.stringify(r.initialOptions))),Ne=ye,G=o.forwardRef((e,r)=>{const{prefixCls:c,createNamespace:N}=o.useContext(Z),[u]=N("picker",c),[x,K]=le(),[w,O]=o.useState([]),{text:_,values:P,children:h}=re({text:"text",values:"values",children:"children"},e.columnsFieldNames),b=o.useRef(null),f=o.useMemo(()=>de(e.itemHeight),[e.itemHeight]),g=o.useMemo(()=>{const{columns:t}=e,n=t[0]||{};if(typeof n=="object"){if(h in n)return"cascade";if(P in n)return"object"}return"plain"},[e.columns]),D=()=>{const t=[];let n={[h]:e.columns};for(;n&&n[h];){const i=n[h];let d=n.defaultIndex??+e.defaultIndex;for(;i[d]&&i[d].disabled;)if(d<i.length-1)d++;else{d=0;break}t.push({[P]:n[h],className:n.className,defaultIndex:d}),n=i[d]}O(t)},E=()=>{const{columns:t}=e;g==="plain"?O([{[P]:t}]):g==="cascade"?D():O(t)},y=()=>x.map(t=>t.getIndex()),k=(t,n)=>{const i=x[t];i&&i.setOptions(n)},M=t=>{let n={[h]:e.columns};const i=y();for(let d=0;d<=t;d+=1)n=n[h][i[d]];for(;n&&n[h];)t+=1,k(t,n[h]),n=n[h][n.defaultIndex||0]},I=t=>x[t],S=t=>{const n=I(t);return(n==null?void 0:n.getValue())||void 0},v=(t,n)=>{const i=I(t);i&&(i.setValue(n),g==="cascade"&&M(t))},j=t=>{const n=I(t);return(n==null?void 0:n.getIndex())||0},H=(t,n)=>{const i=I(t);i&&(i.setIndex(n),g==="cascade"&&M(t))},$=t=>{const n=I(t);return n==null?void 0:n.getOptions()},T=()=>x.map(t=>t.getValue()),L=t=>{t.forEach((n,i)=>{v(i,n)})},U=t=>{t.forEach((n,i)=>{H(i,n)})},F=t=>{g==="cascade"&&M(t),e.onChange&&(g==="plain"?e.onChange(S(0),j(0)):e.onChange(T(),t))},B=()=>{e.onConfirm&&(g==="plain"?e.onConfirm(S(0),j(0)):e.onConfirm(T(),y()))},J=()=>{var t,n;g==="plain"?(t=e.onCancel)==null||t.call(e,S(0),j(0)):(n=e.onCancel)==null||n.call(e,T(),y())},s=()=>e.title?m.jsx("div",{className:C(u("title"),"rc-ellipsis"),children:e.title}):null,a=()=>{const t=e.cancelButtonText||"取消";return m.jsx("button",{type:"button",className:C(u("cancel")),onClick:J,children:t})},l=()=>{const t=e.confirmButtonText||"确认";return m.jsx("button",{type:"button",className:C(u("confirm")),onClick:B,children:t})},R=()=>e.showToolbar?m.jsx("div",{className:C(u("toolbar")),children:e.toolbar||m.jsxs(m.Fragment,{children:[a(),s(),l()]})}):null,V=()=>w.map((t,n)=>m.jsx(Ne,{optionRender:e.optionRender,ref:K(n),textKey:_,readonly:e.readonly,className:t.className,itemHeight:f,defaultIndex:t.defaultIndex??+e.defaultIndex,swipeDuration:e.swipeDuration,visibleItemCount:e.visibleItemCount,initialOptions:t[P],onChange:()=>{F(n)}},String(n))),z=()=>{const t=f*e.visibleItemCount,n={height:`${f}px`},i={height:`${t}px`},d={backgroundSize:`100% ${(t-f)/2}px`};return m.jsxs("div",{ref:b,className:C(u("columns")),style:i,children:[V(),m.jsx("div",{className:C(u("mask")),style:d}),m.jsx("div",{className:C(ue,u("frame")),style:n})]})};return o.useEffect(()=>{E()},[e.columns]),fe("touchmove",me,{target:b.current,depends:[b.current]}),o.useImperativeHandle(r,()=>({confirm:B,getValues:T,setValues:L,getIndexes:y,setIndexes:U,getColumnIndex:j,setColumnIndex:H,getColumnValue:S,setColumnValue:v,getColumnValues:$,setColumnValues:k})),m.jsxs("div",{className:C(u(),e.className),children:[e.toolbarPosition==="top"?R():null,e.loading?m.jsx(ae,{className:C(u("loading"))}):null,e.columnsTop,z(),e.columnsBottom,e.toolbarPosition==="bottom"?R():null]})});G.defaultProps={itemHeight:44,visibleItemCount:5,swipeDuration:1e3,defaultIndex:0,showToolbar:!0,toolbarPosition:"top"};G.displayName="Picker";const Ke=G;export{Ke as P};
