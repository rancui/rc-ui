import{j as a,c as ie}from"./locales-548059eb.js";import{r as c}from"./react-libs-840bfe49.js";import{c as oe}from"./rc-cli_site-mobile-demo-3935d5c1.js";import{P as W}from"./Picker-5fc8c3a2.js";import{c as X}from"./unit-bb3e6514.js";import{d as A}from"./raf-f0838b14.js";import{u as p}from"./use-ref-state-6962d29d.js";import{p as j}from"./string-4e3cebce.js";import{u as ee}from"./use-update-effect-09c1ca0c.js";import{r as K}from"./number-b57f7cd4.js";import{C as ue}from"./ConfigProviderContext-0f984393.js";import{T as me}from"./index-ec9d0b36.js";import{F as le}from"./Field-bf6f7ff1.js";import{P as ce}from"./Popup-a2a0dcda.js";import"./mobile-094a819d.js";import"./use-gesture-react.esm-484f41f1.js";import"./base-1da74170.js";import"./bound-41eb6e06.js";import"./use-set-state-898f20ed.js";import"./Loading-c60598b2.js";import"./use-refs-92151253.js";import"./constant-7552c2aa.js";import"./use-event-listener-721bbec6.js";import"./event-07a78c2b.js";import"./lock-click-c7a7fb0f.js";import"./index-59db7e48.js";import"./render-38a34f7f.js";import"./index-9549eced.js";import"./index-7a676a8e.js";import"./index-9cdb6f61.js";import"./index-cffeb12c.js";import"./use-height-bc7f71cd.js";import"./get-rect-4dc7f7e4.js";import"./scroll-e4e20d56.js";import"./Overlay-d703c016.js";import"./use-touch-76dedc34.js";import"./use-scroll-parent-a4dd715d.js";import"./CSSTransition-ea203202.js";import"./interceptor-35467a90.js";import"./PopupContext-0557b73d.js";function te(e,f){if(e<0)return[];let d=-1;const u=Array(e);for(;++d<e;)u[d]=f(d);return u}function se(e){if(!e)return 0;for(;X(parseInt(e,10));)if(e.length>1)e=e.slice(1);else return 0;return parseInt(e,10)}function L(e,f){return 32-new Date(e,f-1,32).getDate()}function fe(e){return Object.prototype.toString.call(e)==="[object Date]"&&!X(e.getTime())}const z=c.forwardRef((e,f)=>{const{value:d,formatter:u,columnsOrder:g,type:v,filter:n,minDate:s,maxDate:P,...Z}=e,I=t=>(fe(t)||(t=e.minDate),t=Math.max(new Date(t).getTime(),e.minDate.getTime()),t=Math.min(t,e.maxDate.getTime()),new Date(t)),k=c.useRef(null),[m,R,G]=p(I(d)),r=c.useMemo(()=>{const t=(w,C)=>{const O=e[`${w}Date`],J=O.getFullYear();let N=1,B=1,U=0,q=0;return w==="max"&&(N=12,B=L(C.getFullYear(),C.getMonth()+1),U=23,q=59),C.getFullYear()===J&&(N=O.getMonth()+1,C.getMonth()+1===N&&(B=O.getDate(),C.getDate()===B&&(U=O.getHours(),C.getHours()===U&&(q=O.getMinutes())))),{[`${w}Year`]:J,[`${w}Month`]:N,[`${w}Date`]:B,[`${w}Hour`]:U,[`${w}Minute`]:q}},{maxYear:o,maxDate:l,maxMonth:D,maxHour:V,maxMinute:H}=t("max",m),{minYear:S,minDate:Y,minMonth:E,minHour:_,minMinute:F}=t("min",m);let h=[{type:"year",range:[S,o]},{type:"month",range:[E,D]},{type:"day",range:[Y,l]},{type:"hour",range:[_,V]},{type:"minute",range:[F,H]}];switch(e.type){case"date":h=h.slice(0,3);break;case"year-month":h=h.slice(0,2);break;case"month-day":h=h.slice(1,3);break;case"datehour":h=h.slice(0,4);break}if(g){const w=g.concat(h.map(C=>C.type));h.sort((C,O)=>w.indexOf(C.type)-w.indexOf(O.type))}return h},[e,g,m]),i=c.useMemo(()=>r.map(({type:t,range:o})=>{let l=te(o[1]-o[0]+1,D=>j(o[0]+D));return n&&(l=n(t,l)),{type:t,values:l}}),[n,r]),x=c.useMemo(()=>i.map(t=>({values:t.values.map(o=>u(t.type,o))})),[i,u]),y=c.useCallback(()=>{const t=i.map(o=>{switch(o.type){case"year":return u("year",`${m.getFullYear()}`);case"month":return u("month",j(m.getMonth()+1));case"day":return u("day",j(m.getDate()));case"hour":return u("hour",j(m.getHours()));case"minute":return u("minute",j(m.getMinutes()));default:return null}});A(()=>{var o;(o=k.current)==null||o.setValues(t)})},[m,u,i]),$=t=>{const{type:o}=e,l=_=>{let F=0;i.forEach((w,C)=>{_===w.type&&(F=C)});const{values:h}=i[F];return se(h[t[F]])};let D=null,V=null,H=null;o==="month-day"?(D=(m||e.minDate).getFullYear(),V=l("month"),H=l("day")):(D=l("year"),V=l("month"),H=o==="year-month"?1:l("day"));const S=L(D,V);H=H>S?S:H;let Y=0,E=0;return o==="datehour"&&(Y=+l("hour")),o==="datetime"&&(Y=+l("hour"),E=+l("minute")),I(new Date(D,V-1,H,Y,E))},b=()=>{var t;if(k.current){const o=k.current.getIndexes(),l=$(o);l&&l.valueOf()!==(m==null?void 0:m.valueOf())&&R(l),(t=e.onChange)==null||t.call(e,l)}},T=()=>{var t,o;if(k.current){const l=(t=k.current)==null?void 0:t.getIndexes(),D=$(l);D&&D.valueOf()!==(m==null?void 0:m.valueOf())&&R(D),(o=e.onConfirm)==null||o.call(e,D)}};c.useEffect(()=>{y()},[y]);const{minDate:ae,maxDate:re}=e;return ee(()=>{const t=I(d);t&&t.valueOf()!==(m==null?void 0:m.valueOf())&&R(t)},[d,n,ae,re]),c.useImperativeHandle(f,()=>({getPicker:()=>k.current})),a.jsx(W,{...Z,ref:k,columns:x,onChange:b,onConfirm:T,onCancel:e.onCancel})}),Q=new Date().getFullYear();z.defaultProps={type:"datetime",minDate:new Date(Q-10,0,1),maxDate:new Date(Q+10,11,31),formatter:(e,f)=>f};z.displayName="DatePicker";const de=c.memo(z),ne=c.forwardRef((e,f)=>{const d=r=>{const{minHour:i,maxHour:x,minMinute:y,maxMinute:$}=e;r||(r=`${j(i)}:${j(i)}`);let[b,T]=r.split(":");return b=j(K(+b,+i,+x)),T=j(K(+T,+y,+$)),`${b}:${T}`},u=c.useRef(null),[g,v,n]=p(d(e.value)),s=c.useMemo(()=>[{type:"hour",range:[+e.minHour,+e.maxHour]},{type:"minute",range:[+e.minMinute,+e.maxMinute]}],[e.minHour,e.maxHour,e.minMinute,e.maxMinute]),P=c.useMemo(()=>s.map(({type:r,range:i})=>{let x=te(i[1]-i[0]+1,y=>j(i[0]+y));return e.filter&&(x=e.filter(r,x)),{type:r,values:x}}),[s,e.filter]),Z=c.useMemo(()=>P.map(r=>({values:r.values.map(i=>e.formatter(r.type,i))})),[P]),I=c.useCallback(()=>{const r=g.split(":"),i=[e.formatter("hour",r[0]),e.formatter("minute",r[1])];A(()=>{var x;(x=u.current)==null||x.setValues(i)})},[g,e.formatter]),k=r=>{const[i,x]=r,[y,$]=P,b=y.values[i]||y.values[0],T=$.values[x]||$.values[0];return d(`${b}:${T}`)},m=()=>{var r;return(r=e.onConfirm)==null?void 0:r.call(e,g)},R=()=>e.onCancel(),G=r=>{var i;if(u.current){const x=u.current.getIndexes(),y=k(x);v(y),(i=e.onChange)==null||i.call(e,y)}};return c.useEffect(()=>{I()},[I]),ee(()=>{const r=d(e.value);r!==g&&v(r)},[e.value,e.filter,e.minHour,e.maxHour,e.minMinute,e.maxMinute]),c.useImperativeHandle(f,()=>({getPicker:()=>u.current})),a.jsx(W,{ref:u,columns:Z,readonly:e.readonly,onChange:G,onCancel:R,onConfirm:m})});ne.defaultProps={minHour:0,maxHour:23,minMinute:0,maxMinute:59,formatter:(e,f)=>f};const xe=ne,De=c.forwardRef((e,f)=>{const{prefixCls:d,createNamespace:u}=c.useContext(ue),[g]=u("datetime-picker",d),n=e.type==="time"?xe:de;return a.jsx(n,{ref:f,className:ie(g()),...e})}),M=De,nt=()=>{const{DemoBlock:e,DemoSection:f}=oe,[d,u]=c.useState(""),[g,v]=c.useState(!1);return a.jsxs(f,{children:[a.jsx(e,{card:!0,title:"选择年月日",children:a.jsx(M,{title:"选择年月日",type:"date",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date,onChange:n=>console.log(n)})}),a.jsx(e,{card:!0,title:"选择年月",children:a.jsx(M,{type:"year-month",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date,formatter:(n,s)=>n==="year"?`${s}年`:n==="month"?`${s}月`:s,onChange:n=>console.log(n)})}),a.jsx(e,{card:!0,title:"选择月日",children:a.jsx(M,{type:"month-day",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date,formatter:(n,s)=>n==="month"?`${s}月`:n==="day"?`${s}日`:s})}),a.jsx(e,{card:!0,title:"选择时间",children:a.jsx(M,{type:"time",minHour:"10",maxHour:"20",value:"12:00",onChange:n=>console.log(n),onConfirm:n=>console.log(n)})}),a.jsx(e,{card:!0,title:"选择完整时间",children:a.jsx(M,{type:"datetime",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date})}),a.jsx(e,{card:!0,title:"选择年月日小时",children:a.jsx(M,{type:"datehour",minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date})}),a.jsx(e,{card:!0,title:"选择过滤器",children:a.jsx(M,{type:"time",minHour:"10",maxHour:"20",value:"12:00",filter:(n,s)=>n==="minute"?s.filter(P=>+P%5===0):s})}),a.jsx(e,{card:!0,title:"自定义列排序",children:a.jsx(M,{type:"date",columnsOrder:["month","day","year"],minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),value:new Date})}),a.jsx(e,{card:!0,title:"确认按钮",children:a.jsx(M,{onConfirm:n=>me(`确认的日期：${n}`),type:"date",minDate:new Date(2021,0,1),maxDate:new Date(2021,2,1),value:new Date})}),a.jsx(e,{card:!0,title:"搭配弹出层使用",children:a.jsx(le,{readonly:!0,clickable:!0,label:"日期",value:d,placeholder:"选择选择日期",onClick:()=>v(!0)})}),a.jsx(ce,{title:"请选择日期",closeable:!0,visible:g,round:!0,position:"bottom",onClose:()=>v(!1),children:a.jsx("div",{style:{padding:"0 8px"},children:a.jsx(M,{onConfirm:n=>{u(n.toISOString()),v(!1)},type:"date",filter:(n,s)=>n==="minute"?s.filter(P=>+P%5===0):s,minDate:new Date(2021,0,1),maxDate:new Date(2021,2,1),value:new Date})})})]})};export{nt as default};
